<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js latte">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Build an index - Drug resistance Prediction with Reference Graphs</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././theme/catppuccin.css">
        <link rel="stylesheet" href="../.././theme/catppuccin-highlight.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "latte";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="../../installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../../guide/download.html"><strong aria-hidden="true">2.</strong> Download prebuilt index</a></li><li class="chapter-item expanded "><a href="../../guide/predict.html"><strong aria-hidden="true">3.</strong> Predict</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../guide/predict-output.html"><strong aria-hidden="true">3.1.</strong> Prediction output</a></li></ol></li><li class="chapter-item expanded "><a href="../../guide/build/build.html" class="active"><strong aria-hidden="true">4.</strong> Build an index</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../guide/build/vcf.html"><strong aria-hidden="true">4.1.</strong> VCF to build reference graph</a></li><li class="chapter-item expanded "><a href="../../guide/build/catalogue.html"><strong aria-hidden="true">4.2.</strong> Catalogue of mutations</a></li><li class="chapter-item expanded "><a href="../../guide/build/expert.html"><strong aria-hidden="true">4.3.</strong> Expert rules</a></li></ol></li><li class="chapter-item expanded "><a href="../../contributing.html">Contributing</a></li><li class="chapter-item expanded affix "><a href="../../../../CHANGELOG.html">Changes</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Drug resistance Prediction with Reference Graphs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mbhall88/drprg" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mbhall88/drprg/edit/master/guide/src/guide/build/build.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="build-an-index"><a class="header" href="#build-an-index">Build an index</a></h1>
<p>The <code>build</code> subcommand is used to build a custom index to <a href="../predict.html"><code>predict</code></a>
from.</p>
<pre><code>$ drprg build -a annotation.gff3 -i catalogue.tsv -f ref.fa -o outdir
</code></pre>
<h2 id="required"><a class="header" href="#required">Required</a></h2>
<h3 id="catalogue"><a class="header" href="#catalogue">Catalogue</a></h3>
<p>Also referred to as a &quot;panel&quot; sometimes. This is the catalogue of mutations that confer
resistance (or susceptibility). See <a href="./catalogue.html">the Catalogue docs</a> for more
details of what format this file must take. Provided via the <code>-i/--panel</code> option.</p>
<h3 id="reference-genome"><a class="header" href="#reference-genome">Reference genome</a></h3>
<p>A FASTA file of the reference genome that will act as the &quot;skeleton&quot; for the reference
graph. Provided via the <code>-f/--fasta</code> option.</p>
<h3 id="annotation"><a class="header" href="#annotation">Annotation</a></h3>
<p>The annotation is a <a href="https://github.com/The-Sequence-Ontology/Specifications/blob/master/gff3.md">GFF3</a> file for the species you are building the index for.
Provided via the <code>-a/--gff</code> option.</p>
<h3 id="vcf"><a class="header" href="#vcf">VCF</a></h3>
<p>A VCF to build the reference graph from. See <a href="./vcf.html">VCF</a> for a detailed description
of this file. Provided via the <code>-b/--vcf</code> option. This option is mutually exclusive
with <a href="#prebuilt-reference-graph"><code>--prebuilt-prg</code></a>.</p>
<h2 id="optional"><a class="header" href="#optional">Optional</a></h2>
<h3 id="expert-rules"><a class="header" href="#expert-rules">Expert rules</a></h3>
<p>These describe a set of rules - rather than a single mutation - that cause resistance.
See <a href="./expert.html">Expert rules</a> for a detailed description of the rules. Provided via
the <code>-r/--rules</code> option.</p>
<h3 id="padding"><a class="header" href="#padding">Padding</a></h3>
<p>Number of bases to add to the start and end of each gene (locus) in the reference graph.
Set to 100 by default. Provided via the <code>-P/--padding</code> option.</p>
<h3 id="prebuilt-reference-graph"><a class="header" href="#prebuilt-reference-graph">Prebuilt reference graph</a></h3>
<p><strong>Advanced users only.</strong> For those who know how to build their own reference graphs, and
would prefer to do that themselves by hand, rather than let DrPRG do it for them. The
value passed to this option must be a directory containing:</p>
<ul>
<li>A reference graph file named <code>dr.prg</code></li>
<li>A directory of multiple sequence alignments (<code>/msas/</code>) that the reference graph was
built from. There must be a fasta file alignment for each gene in this
directory <code>&lt;gene&gt;.fa</code>.</li>
<li>An optional <a href="https://github.com/rmcolq/pandora"><code>pandora</code></a> index. If not present, one will be created.</li>
</ul>
<p>The reference graph is expected to contain the reference sequence (
with <a href="#padding">padding</a>) for each gene according to the <a href="#annotation">annotation</a>
and <a href="#reference-genome">reference sequence</a> provided.</p>
<p>Provided with the <code>-d/--prebuilt-prg</code> option.</p>
<h3 id="version"><a class="header" href="#version">Version</a></h3>
<p>The version name for the index. Set to the current date (<code>YYYYMMDD</code>) by default.
Provided via the <code>--version</code> option.</p>
<h2 id="quick-usage"><a class="header" href="#quick-usage">Quick usage</a></h2>
<pre><code>$ drprg build -h
Build an index to predict resistance from

Usage: drprg build [OPTIONS] --gff &lt;FILE&gt; --panel &lt;FILE&gt; --fasta &lt;FILE&gt;

Options:
  -v, --verbose            Use verbose output
  -t, --threads &lt;INT&gt;      Maximum number of threads to use [default: 1]
  -P, --padding &lt;INT&gt;      Number of bases of padding to add to start and end of each gene [default: 100]
  -I, --no-fai             Don't index --fasta if an index doesn't exist
  -C, --no-csi             Don't index --vcf if an index doesn't exist
      --version &lt;VERSION&gt;  Version to use for the index [default: 20230405]
  -h, --help               Print help (see more with '--help')

Input/Output:
  -a, --gff &lt;FILE&gt;          Annotation file that will be used to gather information about genes in catalogue
  -i, --panel &lt;FILE&gt;        Panel/catalogue to build index for
  -f, --fasta &lt;FILE&gt;        Reference genome in FASTA format (must be indexed with samtools faidx)
  -b, --vcf &lt;FILE&gt;          An indexed VCF to build the index PRG from. If not provided, then a prebuilt PRG must be given. See `--prebuilt-prg`
  -o, --outdir &lt;DIR&gt;        Directory to place output [default: .]
  -d, --prebuilt-prg &lt;DIR&gt;  A prebuilt PRG to use
  -r, --rules &lt;FILE&gt;        &quot;Expert rules&quot; to be applied in addition to the catalogue
</code></pre>
<h2 id="full-usage"><a class="header" href="#full-usage">Full usage</a></h2>
<pre><code>$ drprg build --help
Build an index to predict resistance from

Usage: drprg build [OPTIONS] --gff &lt;FILE&gt; --panel &lt;FILE&gt; --fasta &lt;FILE&gt;

Options:
  -p, --pandora &lt;FILE&gt;
          Path to pandora executable. Will try in src/ext or $PATH if not given

  -v, --verbose
          Use verbose output

  -m, --makeprg &lt;FILE&gt;
          Path to make_prg executable. Will try in src/ext or $PATH if not given

  -t, --threads &lt;INT&gt;
          Maximum number of threads to use

          Use 0 to select the number automatically

          [default: 1]

  -M, --mafft &lt;FILE&gt;
          Path to MAFFT executable. Will try in src/ext or $PATH if not given

  -B, --bcftools &lt;FILE&gt;
          Path to bcftools executable. Will try in src/ext or $PATH if not given

  -P, --padding &lt;INT&gt;
          Number of bases of padding to add to start and end of each gene

          [default: 100]

  -l, --match-len &lt;INT&gt;
          Minimum number of consecutive characters which must be identical for a match in make_prg

          [default: 5]

  -N, --max-nesting &lt;INT&gt;
          Maximum nesting level when constructing the reference graph with make_prg

          [default: 5]

  -k, --pandora-k &lt;INT&gt;
          Kmer size to use for pandora

          [default: 15]

  -w, --pandora-w &lt;INT&gt;
          Window size to use for pandora

          [default: 11]

  -I, --no-fai
          Don't index --fasta if an index doesn't exist

  -C, --no-csi
          Don't index --vcf if an index doesn't exist

      --version &lt;VERSION&gt;
          Version to use for the index

          [default: 20230405]

  -h, --help
          Print help (see a summary with '-h')

Input/Output:
  -a, --gff &lt;FILE&gt;
          Annotation file that will be used to gather information about genes in catalogue

  -i, --panel &lt;FILE&gt;
          Panel/catalogue to build index for

  -f, --fasta &lt;FILE&gt;
          Reference genome in FASTA format (must be indexed with samtools faidx)

  -b, --vcf &lt;FILE&gt;
          An indexed VCF to build the index PRG from. If not provided, then a prebuilt PRG must be given. See `--prebuilt-prg`

  -o, --outdir &lt;DIR&gt;
          Directory to place output

          [default: .]

  -d, --prebuilt-prg &lt;DIR&gt;
          A prebuilt PRG to use.

          Only build the panel VCF and reference sequences - not the PRG. This directory MUST contain a PRG file named `dr.prg`, along, with a directory called `msas/` that contains an MSA fasta file for each gene `&lt;gene&gt;.fa`. There can optionally also be a pandora index file, but if not, the indexing will be performed by drprg. Note: the PRG is expected to contain the reference sequence for each gene according to the annotation and reference genome given (along with padding) and must be in the forward strand orientation.

  -r, --rules &lt;FILE&gt;
          &quot;Expert rules&quot; to be applied in addition to the catalogue.

          CSV file with blanket rules that describe resistance (or susceptibility). The columns are &lt;variant type&gt;,&lt;gene&gt;,&lt;start&gt;,&lt;end&gt;,&lt;drug(s)&gt;. See the docs for a detailed explanation.
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../guide/predict-output.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../guide/build/vcf.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../guide/predict-output.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../guide/build/vcf.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
